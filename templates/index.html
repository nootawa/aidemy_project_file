<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Casting Defect Classifier</title>
    <link rel="stylesheet" href="./static/stylesheet.css">
    <!-- ファビコンの設定 icoファイルをcssと同列にしたら表示できた -->
    <link rel="icon" href="./static/favicon.ico" type="image/x-icon">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        header {
            display: flex;
            align-items: center;
            background-color: #333;
            color: white;
            padding: 10px;
        }
        .header_img {
            height: 50px;
            margin-right: 10px;
        }
        .header-logo {
            font-size: 24px;
            color: white;
            text-decoration: none;
        }
        .main {
            padding: 20px;
        }
        .answer {
            margin-top: 20px;
            font-size: 20px;
            font-weight: bold;
        }
        .loading-content {
            display: flex;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
        }
        .loader {
            text-align: center;
        }
        .loader-text {
            font-size: 24px;
            margin-top: 20px;
        }
        footer {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #333;
            color: white;
            padding: 10px;
            position: fixed;
            bottom: 0;
            width: 100%;
        }
        .footer_img {
            height: 50px;
            margin-right: 10px;
        }
    </style>
    <script>
        function validateUpload() {
            var fileInput = document.getElementById('fileInput');
            var uploadButton = document.getElementById('uploadButton');

            // ファイルが選択されているかをチェック
            if (fileInput.value) {
                uploadButton.disabled = false; // 選択されていればボタンを有効化
            } else {
                uploadButton.disabled = true; // 選択されていなければボタンを無効化
            }
        }

        // ページ読み込み時に初期状態を確認
        document.addEventListener('DOMContentLoaded', function() {
            var fileInput = document.getElementById('fileInput');
            var uploadButton = document.getElementById('uploadButton');

            // 初期状態でファイルが選択されているかをチェック
            validateUpload();

            // ファイル選択時のイベントリスナーを設定
            fileInput.addEventListener('change', validateUpload);

            uploadButton.addEventListener("click", function (event) {
                event.preventDefault();
                const formData = new FormData(document.getElementById('uploadForm'));

                const xhr = new XMLHttpRequest();
                xhr.open("POST", "upload.php", true);
                
                // loading button 表示
                const loading = document.querySelector('.js-loading');
                loading.style.display = 'block';

                xhr.onload = () => {
                    // loading button 非表示
                    loading.style.display = 'none';

                    if (xhr.readyState == 4 && xhr.status == 200) {
                        const response = JSON.parse(xhr.responseText);
                        document.querySelector('.answer').innerText = response.answer;
                    } else {
                        console.log(`Error: ${xhr.status}`);
                    }
                };
                xhr.send(formData);
            }, false);
        });
    </script>
</head>
<body>
    <header>
        <img class="header_img" src="https://aidemyexstorage.blob.core.windows.net/aidemycontents/1621500180546399.png" alt="Aidemy">
        <a class="header-logo" href="#">Casting Defect Classifier</a>
    </header>
    <div class="main">
        <h1>AIアプリ開発講座成果物</h1>
        <h2>AIが送信された画像の異常または正常のどちらかに分類します</h2>
        <p>画像をアップロードしてください</p>
        <p>アップロードされた画像は、AIにより異常/正常の判定が行われ、その結果が表示されます</p>
        <form id="uploadForm" action="upload.php" method="post" enctype="multipart/form-data">
          <input type="file" id="fileInput" name="fileInput">
          <button type="submit" id="uploadButton" disabled>アップロード</button>
        </form>
      
        <div class="answer">{{answer}}</div>
        <a href="https://drive.google.com/file/d/14ftPlzf0_YUm1h7RgwZAfNizKp2qym4c/view?usp=drive_link" download>異常画像 ここをクリックして画像ファイルをダウンロード</a>
        <br>
        <br>
        <a href="https://drive.google.com/file/d/1wEhfq1mfI0SYfxV1h-vb122pgNKDHkCk/view?usp=drive_link" download>正常画像 ここをクリックして画像ファイルをダウンロード</a>
    </div>
    <div class="loading-content js-loading" style="display: none;">
        <div class="loader">
            <p class="loader-text">Loading</p>
        </div>
    </div>
    <footer>
        <img class="footer_img" src="https://aidemyexstorage.blob.core.windows.net/aidemycontents/1621500180546399.png" alt="Aidemy">
        <small>&copy; 2024 NO, inc.</small>
    </footer>
</body>
</html>
